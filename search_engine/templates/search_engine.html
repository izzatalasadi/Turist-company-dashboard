{% extends "base.html" %} {% block title %}DMC Guests Search Engine{% endblock
%} {% block body %}
<div class="container mt-5">
  <div class="row justify-content-center">
    {% include 'partials/_main_header.html' %}
  </div>

  <div class="row">
    <div class="col">
      <div class="row mb-4">
        <div class="col-lg-12 col-md-12 col-sm-12">
          <div class="row">
            <!-- Flights Box -->
            <div class="col-lg-4 col-md-4 col-sm-4 mb-3">
              <div class="box">
                <h5>
                  <a class="btn btn-link" data-bs-toggle="collapse" href="#flightsCollapse" role="button" aria-expanded="false" aria-controls="flightsCollapse">
                    Flights
                  </a>
                </h5>
                <div class="collapse" id="flightsCollapse">
                  <div class="d-flex flex-wrap flight-filter">
                    {% for flight, color in (flight_colors|default({})).items() %}
                      <a href="{{ url_for('app.search', search_query=request.args.get('search_query', ''), flight=flight) }}"
                         class="btn flight-filter-btn m-1"
                         style="background-color: {{ color }}; color: #fff;">
                        {{ flight }}
                      </a>
                    {% endfor %}
                  </div>
                </div>
              </div>
            </div>

            <!-- Arrival Times Box -->
            <div class="col-lg-4 col-md-4 col-sm-4 mb-3">
              <div class="box">
                <h5>
                  <a class="btn btn-link" data-bs-toggle="collapse" href="#arrivalTimesCollapse" role="button" aria-expanded="false" aria-controls="arrivalTimesCollapse">
                    Arrival Times
                  </a>
                </h5>
                <div class="collapse" id="arrivalTimesCollapse">
                  <div class="d-flex flex-wrap arrival-time-filter">
                    {% for arrival_time, color in (arrival_time_colors|default({})).items() %}
                      <a href="{{ url_for('app.search', search_query=request.args.get('search_query', ''), arrival_time=arrival_time) }}"
                         class="btn arrival-time-filter-btn m-1"
                         style="background-color: {{ color }}; color: #fff;">
                        {{ arrival_time }}
                      </a>
                    {% endfor %}
                  </div>
                </div>
              </div>
            </div>

            <!-- Departure Locations Box -->
            <div class="col-lg-4 col-md-4 col-sm-4 mb-3">
              <div class="box">
                <h5>
                  <a class="btn btn-link" data-bs-toggle="collapse" href="#departureLocationsCollapse" role="button" aria-expanded="false" aria-controls="departureLocationsCollapse">
                    Departure Locations
                  </a>
                </h5>
                <div class="collapse" id="departureLocationsCollapse">
                  <div class="d-flex flex-wrap departure-from-filter">
                    {% for departure_from, color in (departure_from_colors|default({})).items() %}
                      <a href="{{ url_for('app.search', search_query=request.args.get('search_query', ''), departure_from=departure_from) }}"
                         class="btn departure-from-filter-btn m-1"
                         style="background-color: {{ color }}; color: #fff;">
                        {{ departure_from }}
                      </a>
                    {% endfor %}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="container mb-5">
        <form
          method="POST"
          action="{{ url_for('app.search') }}"
          class="input-group"
        > 
          <input
            type="text"
            class="form-control"
            id="search_query"
            name="search_query"
            placeholder="Search for guests, flights, or booking numbers..."
            aria-label="Search"
          />{{ form.hidden_tag() }}
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button class="btn btn-outline-secondary" type="submit">
            <i class="fas fa-search"></i>
          </button>
        </form>
      </div>

      <div class="row">
        {% for entry in filtered_data %}
        <div class="col-lg-4 col-sm-6 grid-margin stretch-card">
          <div
            class="card search-result-card"
            data-booking-number="{{ entry.booking }}"
          >
            <div class="card-body">
              <h5 class="card-title">
                <i class="mdi mdi-account m-auto text-primary"></i> {{
                entry.last_name }}, {{ entry.first_name }}
              </h5>
              <p class="card-text">
                <i class="mdi mdi-airplane m-auto text-primary"></i>
                <strong>Flight:</strong> {{ entry.flight }}
              </p>
              <p class="card-text">
                <i class="mdi mdi-home-map-marker m-auto text-primary"></i>
                <strong>Departure:</strong> {{ entry.departure_from }}
              </p>
              <p class="card-text">
                <i class="mdi mdi-clock-end m-auto text-primary"></i>
                <strong>Arrival Time:</strong> {{ entry.arrival_time }}
              </p>
              <p class="card-text">
                <i class="mdi mdi-book-open m-auto text-primary"></i>
                <strong>Booking Number:</strong> {{ entry.booking }}
              </p>
              <p class="card-text">
                <i class="mdi mdi-bus m-auto text-primary"></i>
                <strong>Transportation:</strong> {{ entry.transportation }}
              </p>
              <p class="card-text">
                <i class="mdi mdi-comment-processing m-auto text-primary"></i>
                <strong>Comments:</strong> {{ entry.comments }}
              </p>
            </div>
            <div class="card-footer">
              <div class="d-flex justify-content-between">
                {% if current_user.is_authenticated %}
                <div>
                  <button
                    class="btn btn-success add-btn"
                    data-booking-number="{{ entry.booking }}"
                    style="{{ 'display: none;' if entry.status == 'Checked' }}"
                  >
                    Mark as Checked
                  </button>
                  <button
                    class="btn btn-danger remove-btn"
                    data-booking-number="{{ entry.booking }}"
                    style="{{ 'display: none;' if entry.status != 'Checked' }}"
                  >
                    Unmark
                  </button>
                </div>
                {% endif %} {% if current_user.is_admin %}
                <div>
                  <button
                    id="editButton"
                    class="btn btn-light edit-btn"
                    onclick="openEditModal('{{ entry.id }}')"
                    data-toggle="modal"
                    data-target="#editGuestModal"
                    data-id="{{ entry.id }}"
                  >
                    Edit Details
                  </button>
                </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        {% else %}
        <div class="col text-center">
          <p>No results found. Please adjust your search criteria.</p>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<!-- Edit Guest Modal -->
<div
  class="modal fade"
  id="editGuestModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="editGuestModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editGuestModalLabel"></h5>
        <button
          type="button"
          class="close"
          data-bs-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="editGuestForm">{{ form.hidden_tag() }}</form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Close
        </button>
        <button type="button" id="saveChangesButton" class="btn btn-primary">
          Save changes
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock %}
